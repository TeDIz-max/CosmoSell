<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0a0a0a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>CosmoSell | Telegram Stars</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap">
    <style>
        /* Базовые стили */
        :root {
            --primary: #4a9eff;
            --primary-dark: #2d8cff;
            --primary-light: rgba(74, 158, 255, 0.15);
            --success: #00ff9d;
            --success-light: rgba(0, 255, 157, 0.15);
            --warning: #ffaa00;
            --warning-light: rgba(255, 170, 0, 0.15);
            --error: #ff4444;
            --error-light: rgba(255, 68, 68, 0.15);
            --bg: #0a0a0a;
            --bg-secondary: #151515;
            --bg-card: rgba(20, 20, 20, 0.95);
            --text: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-tertiary: rgba(255, 255, 255, 0.5);
            --border: rgba(255, 255, 255, 0.1);
            --border-light: rgba(255, 255, 255, 0.05);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 15px 50px rgba(0, 0, 0, 0.5);
            --radius: 20px;
            --radius-sm: 12px;
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        html, body {
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
            overflow: hidden;
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }

        body {
            line-height: 1.5;
            touch-action: pan-y;
            overscroll-behavior: none;
        }

        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOutLeft {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(-100%);
            }
        }

        @keyframes fadeInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(74, 158, 255, 0.4); }
            50% { box-shadow: 0 0 35px rgba(74, 158, 255, 0.7); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Основной контейнер */
        .app {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* Фоновые эффекты */
        .bg-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .gradient-bg {
            position: absolute;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(74, 158, 255, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 255, 157, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 68, 68, 0.1) 0%, transparent 50%);
            animation: float 30s ease-in-out infinite;
        }

        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .particle {
            position: absolute;
            background: var(--primary);
            border-radius: 50%;
            opacity: 0.15;
        }

        /* Header - фиксированный */
        .header {
            padding: 18px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
            flex-shrink: 0;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(0);
            will-change: transform;
        }

        .header.hidden {
            transform: translateY(-100%);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .logo-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: glow 3s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.1),
                transparent
            );
            transform: rotate(45deg);
        }

        .logo-icon i {
            font-size: 20px;
            color: white;
            position: relative;
            z-index: 1;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary), #6bb5ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .menu-toggle {
            background: var(--primary-light);
            border: 1px solid rgba(74, 158, 255, 0.3);
            color: var(--primary);
            width: 48px;
            height: 48px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            z-index: 101;
        }

        .menu-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 158, 255, 0.2);
        }

        .menu-toggle::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.1),
                transparent
            );
            transition: left 0.6s ease;
        }

        .menu-toggle:hover::before {
            left: 100%;
        }

        .menu-toggle i {
            position: relative;
            z-index: 1;
        }

        /* Боковое меню */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 85%;
            max-width: 320px;
            background: var(--bg-card);
            backdrop-filter: blur(35px);
            -webkit-backdrop-filter: blur(35px);
            border-right: 1px solid var(--border);
            z-index: 1000;
            transform: translateX(-100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 30px 0 60px rgba(0, 0, 0, 0.5);
        }

        .sidebar.active {
            transform: translateX(0);
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--success));
        }

        .sidebar-header {
            padding: 28px 24px;
            border-bottom: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.02);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 18px;
            background: linear-gradient(135deg, var(--primary), var(--success));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            color: white;
            font-weight: 700;
            position: relative;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 18px;
            font-weight: 700;
            color: white;
            margin-bottom: 4px;
        }

        .user-username {
            font-size: 14px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-username i {
            color: var(--primary);
            font-size: 12px;
        }

        .sidebar-content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .menu-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px 24px;
            border-radius: 16px;
            text-decoration: none;
            color: var(--text);
            background: transparent;
            border: none;
            font-family: inherit;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .menu-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.05),
                transparent
            );
            transition: left 0.6s ease;
        }

        .menu-item:hover::before {
            left: 100%;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(8px);
        }

        .menu-item.active {
            background: var(--primary-light);
            color: var(--primary);
        }

        .menu-item.active .menu-icon {
            color: var(--primary);
        }

        .menu-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 18px;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .menu-item:hover .menu-icon {
            background: rgba(255, 255, 255, 0.1);
            color: var(--primary);
        }

        .menu-item.active .menu-icon {
            background: var(--primary);
            color: white;
        }

        .sidebar-footer {
            padding: 24px;
            border-top: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.02);
        }

        .app-info {
            font-size: 12px;
            color: var(--text-tertiary);
            text-align: center;
            line-height: 1.5;
        }

        .app-info strong {
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* Страница "О программе" */
        .about-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg);
            z-index: 2000;
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            padding: 20px;
            padding-top: calc(var(--safe-top) + 80px);
        }

        .about-page.active {
            transform: translateX(0);
        }

        .about-header {
            margin-bottom: 30px;
        }

        .about-back {
            position: absolute;
            top: calc(var(--safe-top) + 20px);
            left: 20px;
            background: var(--primary-light);
            border: 1px solid rgba(74, 158, 255, 0.3);
            color: var(--primary);
            width: 48px;
            height: 48px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1;
        }

        .about-back:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 158, 255, 0.2);
        }

        .about-title {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 10px;
        }

        .about-subtitle {
            text-align: center;
            color: var(--text-secondary);
            font-size: 16px;
            margin-bottom: 40px;
        }

        .about-content {
            max-width: 600px;
            margin: 0 auto;
        }

        .about-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 28px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
            animation: fadeIn 0.5s ease;
        }

        .about-card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .about-card-text {
            color: var(--text-secondary);
            line-height: 1.6;
            font-size: 15px;
        }

        .about-card-text i {
            font-style: italic;
            color: var(--text);
        }

        .about-card-text strong {
            color: var(--text);
            font-weight: 700;
        }

        /* Основной контент */
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            position: relative;
            z-index: 1;
        }

        .content {
            padding: 20px;
            padding-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 18px;
            min-height: calc(100% + 1px);
        }

        /* Карточки */
        .card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 26px;
            border: 1px solid var(--border);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }

        .card:hover {
            border-color: rgba(74, 158, 255, 0.3);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.2s; }
        .card:nth-child(3) { animation-delay: 0.3s; }
        .card:nth-child(4) { animation-delay: 0.4s; }
        .card:nth-child(5) { animation-delay: 0.5s; }

        .card-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 22px;
        }

        .card-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-light);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 20px;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .card-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.1),
                transparent
            );
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .card:hover .card-icon::before {
            transform: translateX(100%);
        }

        .card-title {
            font-size: 19px;
            font-weight: 700;
            color: var(--text);
            line-height: 1.3;
        }

        .card-content {
            color: var(--text-secondary);
            font-size: 16px;
            line-height: 1.6;
        }

        .highlight {
            color: var(--primary);
            font-weight: 700;
            background: var(--primary-light);
            padding: 4px 10px;
            border-radius: 8px;
            display: inline-block;
            margin: 3px 0;
            transition: all 0.3s ease;
        }

        .highlight:hover {
            transform: scale(1.05);
        }

        /* Информация о получателе */
        .recipient-card {
            background: linear-gradient(135deg, var(--primary-light), rgba(74, 158, 255, 0.05));
            border: 1px solid rgba(74, 158, 255, 0.25);
            border-radius: var(--radius);
            padding: 22px;
            margin-bottom: 10px;
            animation: slideDown 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .recipient-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--success));
        }

        .recipient-label {
            font-size: 14px;
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .recipient-value {
            font-size: 20px;
            font-weight: 800;
            color: white;
            word-break: break-all;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Поле ввода username */
        .username-input-section {
            margin-bottom: 28px;
            display: none;
        }

        .username-input-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .username-input-wrapper {
            position: relative;
        }

        .username-input {
            width: 100%;
            padding: 22px;
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid var(--border);
            border-radius: 18px;
            color: white;
            font-size: 18px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            outline: none;
        }

        .username-input:focus {
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.05);
            box-shadow: 0 0 0 4px rgba(74, 158, 255, 0.15);
        }

        .username-input::placeholder {
            color: var(--text-tertiary);
        }

        .username-hint {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-top: 8px;
            padding-left: 8px;
        }

        .username-hint i {
            color: var(--primary);
            margin-right: 6px;
        }

        /* Калькулятор */
        .calculator-card {
            margin-top: 5px;
        }

        .input-section {
            margin-bottom: 28px;
        }

        .input-label {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 17px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 18px;
        }

        .stars-input-wrapper {
            position: relative;
        }

        .stars-input {
            width: 100%;
            padding: 24px;
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid var(--border);
            border-radius: 18px;
            color: white;
            font-size: 24px;
            font-weight: 800;
            text-align: center;
            font-family: 'SF Mono', 'Courier New', monospace;
            transition: all 0.3s ease;
            outline: none;
            letter-spacing: 1px;
        }

        .stars-input:focus {
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.05);
            box-shadow: 0 0 0 4px rgba(74, 158, 255, 0.15);
        }

        .input-hint {
            display: flex;
            justify-content: space-between;
            margin-top: 14px;
            font-size: 14px;
            color: var(--text-tertiary);
        }

        /* Результаты */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 18px;
            margin: 32px 0;
        }

        .result-item {
            background: var(--bg-secondary);
            border-radius: 18px;
            padding: 24px;
            text-align: center;
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
            animation: scaleIn 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .result-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--success));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .result-item:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .result-item:hover::before {
            transform: scaleX(1);
        }

        .result-label {
            font-size: 15px;
            color: var(--text-secondary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 600;
        }

        .result-value {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(90deg, var(--success), #00e676);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-family: 'SF Mono', monospace;
            margin: 8px 0;
            letter-spacing: -0.5px;
        }

        .result-unit {
            font-size: 14px;
            color: var(--text-tertiary);
            margin-top: 8px;
        }

        /* Кнопки */
        .btn {
            width: 100%;
            padding: 24px;
            border: none;
            border-radius: 18px;
            font-size: 17px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            position: relative;
            overflow: hidden;
            margin-top: 10px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.1),
                transparent
            );
            transition: left 0.6s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 6px 25px rgba(74, 158, 255, 0.4);
        }

        .btn-primary:hover {
            box-shadow: 0 10px 35px rgba(74, 158, 255, 0.6);
            transform: translateY(-3px);
        }

        .btn-success {
            background: linear-gradient(135deg, #00c853, #00e676);
            color: white;
            box-shadow: 0 6px 25px rgba(0, 200, 83, 0.4);
        }

        .btn-success:hover {
            box-shadow: 0 10px 35px rgba(0, 200, 83, 0.6);
            transform: translateY(-3px);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #ffcc00);
            color: white;
            box-shadow: 0 6px 25px rgba(255, 170, 0, 0.4);
        }

        .btn-warning:hover {
            box-shadow: 0 10px 35px rgba(255, 170, 0, 0.6);
            transform: translateY(-3px);
        }

        .btn-disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-disabled:hover {
            transform: none !important;
            box-shadow: none !important;
        }

        /* Модальные окна */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.97);
            backdrop-filter: blur(35px);
            -webkit-backdrop-filter: blur(35px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-card);
            border-radius: 30px;
            padding: 36px;
            width: 100%;
            max-width: 440px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border);
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6);
            position: relative;
        }

        .modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--success), var(--primary));
            border-radius: 30px 30px 0 0;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
            opacity: 1;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 26px;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary), #6bb5ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
            padding: 14px;
            border-radius: 50%;
            width: 52px;
            height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: rotate(90deg);
        }

        /* Карта оплаты */
        .card-payment {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            border: 1px solid var(--border);
            border-radius: 22px;
            padding: 28px;
            margin: 28px 0;
            position: relative;
            overflow: hidden;
        }

        .card-payment::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--success));
        }

        .bank-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .bank-info {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .bank-logo {
            width: 54px;
            height: 54px;
            background: linear-gradient(135deg, #ff2e2e, #ff6b6b);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
            font-weight: 800;
        }

        .bank-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .bank-name {
            font-size: 22px;
            font-weight: 700;
            color: white;
        }

        .bank-type {
            font-size: 14px;
            color: var(--text-tertiary);
        }

        .card-number {
            font-size: 30px;
            font-weight: 800;
            letter-spacing: 3px;
            text-align: center;
            margin: 24px 0;
            padding: 24px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 18px;
            border: 1px solid var(--border);
            font-family: 'SF Mono', monospace;
            cursor: pointer;
            transition: all 0.3s ease;
            word-break: break-all;
            position: relative;
            overflow: hidden;
        }

        .card-number::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.05),
                transparent
            );
            transition: left 0.6s ease;
        }

        .card-number:hover::before {
            left: 100%;
        }

        .card-number:active {
            background: rgba(255, 255, 255, 0.08);
            transform: scale(0.99);
        }

        .copy-hint {
            text-align: center;
            font-size: 15px;
            color: var(--text-tertiary);
            margin-top: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* ID вывода */
        .withdrawal-container {
            background: var(--success-light);
            border: 1px solid rgba(0, 255, 157, 0.25);
            border-radius: 22px;
            padding: 24px;
            margin: 24px 0;
            position: relative;
            overflow: hidden;
        }

        .withdrawal-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--success), #00e676);
        }

        .withdrawal-label {
            font-size: 15px;
            color: var(--success);
            font-weight: 600;
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .withdrawal-value {
            font-size: 22px;
            font-weight: 800;
            font-family: 'SF Mono', monospace;
            color: white;
            text-align: center;
            padding: 20px;
            background: rgba(0, 255, 157, 0.1);
            border-radius: 16px;
            border: 1px solid rgba(0, 255, 157, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            word-break: break-all;
            position: relative;
            overflow: hidden;
        }

        .withdrawal-value::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(0, 255, 157, 0.1),
                transparent
            );
            transition: left 0.6s ease;
        }

        .withdrawal-value:hover::before {
            left: 100%;
        }

        .withdrawal-value:active {
            background: rgba(0, 255, 157, 0.2);
            transform: scale(0.99);
        }

        /* Важное примечание */
        .important-note {
            background: var(--warning-light);
            border: 1px solid rgba(255, 170, 0, 0.3);
            border-radius: 22px;
            padding: 24px;
            margin: 24px 0;
            animation: pulse 3s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        .important-note::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--warning), #ffcc00);
        }

        .note-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 16px;
        }

        .note-icon {
            color: var(--warning);
            font-size: 22px;
        }

        .note-title {
            color: var(--warning);
            font-weight: 700;
            font-size: 18px;
        }

        .note-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 15px;
            line-height: 1.6;
        }

        .note-content strong {
            color: white;
            font-weight: 700;
        }

        /* Детали платежа */
        .details-list {
            margin: 28px 0;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 0;
            border-bottom: 1px solid var(--border-light);
            transition: all 0.3s ease;
        }

        .detail-item:hover {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            padding: 18px 12px;
            transform: translateX(4px);
        }

        .detail-label {
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 500;
        }

        .detail-value {
            color: var(--text);
            font-weight: 700;
            text-align: right;
            max-width: 60%;
            word-break: break-word;
            font-family: 'SF Mono', monospace;
        }

        .detail-value.highlight {
            color: var(--primary);
            font-size: 20px;
            font-weight: 800;
        }

        /* Загрузка */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-content {
            text-align: center;
            width: 90%;
            max-width: 340px;
            padding: 44px;
            background: var(--bg-card);
            border-radius: 28px;
            border: 1px solid var(--border);
            animation: scaleIn 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .loading-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--success));
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 28px;
            position: relative;
        }

        .loading-spinner::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border: 4px solid transparent;
            border-top-color: var(--success);
            border-radius: 50%;
            animation: spin 2s linear infinite;
        }

        .loading-title {
            font-size: 24px;
            color: white;
            font-weight: 700;
            margin-bottom: 14px;
        }

        .loading-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 28px;
        }

        .loading-progress {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            width: 45%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            animation: shimmer 2s ease-in-out infinite;
            border-radius: 3px;
        }

        /* Ожидание оплаты */
        .waiting-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2500;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .waiting-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .waiting-content {
            text-align: center;
            width: 90%;
            max-width: 380px;
            padding: 44px;
            background: var(--bg-card);
            border-radius: 28px;
            border: 1px solid var(--border);
            animation: scaleIn 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .waiting-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--warning));
        }

        .waiting-icon {
            width: 90px;
            height: 90px;
            background: var(--warning-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 28px;
            color: var(--warning);
            font-size: 36px;
            animation: pulse 2s ease-in-out infinite;
        }

        .waiting-title {
            font-size: 26px;
            color: white;
            font-weight: 800;
            margin-bottom: 16px;
        }

        .waiting-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 32px;
        }

        .waiting-details {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            padding: 20px;
            margin: 24px 0;
            border: 1px solid var(--border);
        }

        .waiting-detail {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-light);
        }

        .waiting-detail:last-child {
            border-bottom: none;
        }

        .waiting-label {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .waiting-value {
            color: white;
            font-weight: 700;
            text-align: right;
        }

        .admin-buttons {
            display: flex;
            gap: 16px;
            margin-top: 24px;
        }

        .admin-btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 14px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .admin-approve {
            background: linear-gradient(135deg, var(--success), #00e676);
            color: white;
        }

        .admin-cancel {
            background: linear-gradient(135deg, var(--error), #ff6b6b);
            color: white;
        }

        /* Уведомления */
        .toast {
            position: fixed;
            top: 24px;
            right: 24px;
            background: var(--bg-card);
            color: white;
            padding: 18px 26px;
            border-radius: 16px;
            border: 1px solid var(--border);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            z-index: 3000;
            animation: slideDown 0.3s ease;
            display: flex;
            align-items: center;
            gap: 14px;
            max-width: 90%;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            transform: translateY(0);
            transition: all 0.3s ease;
        }

        .toast.hiding {
            opacity: 0;
            transform: translateY(-20px);
        }

        .toast::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            border-radius: 16px 0 0 16px;
        }

        .toast.success::before {
            background: var(--success);
        }

        .toast.error::before {
            background: var(--error);
        }

        .toast.warning::before {
            background: var(--warning);
        }

        .toast.info::before {
            background: var(--primary);
        }

        .toast-icon {
            font-size: 22px;
        }

        .toast.success .toast-icon {
            color: var(--success);
        }

        .toast.error .toast-icon {
            color: var(--error);
        }

        .toast.warning .toast-icon {
            color: var(--warning);
        }

        .toast.info .toast-icon {
            color: var(--primary);
        }

        .toast-message {
            font-size: 15px;
            font-weight: 500;
            flex: 1;
        }

        /* Индикатор скролла */
        .scroll-indicator {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--success));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
            z-index: 101;
            border-radius: 0 0 2px 2px;
        }

        /* Адаптивность */
        @media (max-width: 480px) {
            .content {
                padding: 16px;
                gap: 16px;
            }
            
            .card {
                padding: 22px;
            }
            
            .result-value {
                font-size: 32px;
            }
            
            .card-number {
                font-size: 26px;
                letter-spacing: 2px;
                padding: 20px;
            }
            
            .modal {
                padding: 28px;
            }
            
            .modal-title {
                font-size: 24px;
            }
            
            .sidebar {
                width: 85%;
            }
            
            .admin-buttons {
                flex-direction: column;
            }
        }

        @media (max-width: 375px) {
            .header {
                padding: 16px;
            }
            
            .logo-icon {
                width: 40px;
                height: 40px;
            }
            
            .logo-text {
                font-size: 22px;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .btn {
                padding: 22px;
                font-size: 16px;
            }
            
            .user-avatar {
                width: 50px;
                height: 50px;
                font-size: 22px;
            }
            
            .user-name {
                font-size: 16px;
            }
            
            .menu-item {
                padding: 18px 20px;
                font-size: 15px;
            }
            
            .menu-icon {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .waiting-content {
                padding: 32px;
            }
            
            .waiting-title {
                font-size: 22px;
            }
        }

        @media (max-width: 320px) {
            .modal {
                padding: 24px;
            }
            
            .card-number {
                font-size: 22px;
                letter-spacing: 1px;
            }
            
            .detail-value {
                font-size: 14px;
            }
            
            .sidebar {
                width: 90%;
            }
            
            .username-input {
                padding: 18px;
                font-size: 16px;
            }
        }

        /* Фиксы для iOS */
        @supports (-webkit-touch-callout: none) {
            .content-wrapper {
                padding-bottom: calc(var(--safe-bottom) + 20px);
            }
            
            .btn:active {
                opacity: 0.8;
            }
            
            .card-number:active,
            .withdrawal-value:active {
                opacity: 0.9;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Фоновые эффекты -->
        <div class="bg-effects">
            <div class="gradient-bg"></div>
            <div class="particles" id="particles"></div>
        </div>

        <!-- Боковое меню -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="user-profile">
                    <div class="user-avatar" id="userAvatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-info">
                        <div class="user-name" id="userName">Пользователь</div>
                        <div class="user-username">
                            <i class="fas fa-at"></i>
                            <span id="userUsername">@username</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-content">
                <div class="menu-items">
                    <button class="menu-item active" data-page="main">
                        <div class="menu-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <span>Пополнить звёзды</span>
                    </button>
                    
                    <button class="menu-item" data-page="gift">
                        <div class="menu-icon">
                            <i class="fas fa-gift"></i>
                        </div>
                        <span>Подарить другу</span>
                    </button>
                    
                    <button class="menu-item" data-page="partner">
                        <div class="menu-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <span>Партнерская программа</span>
                    </button>
                    
                    <button class="menu-item" data-page="about">
                        <div class="menu-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <span>О программе</span>
                    </button>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="app-info">
                    <strong>CosmoSell v1.0</strong><br>
                    © 2024 Все права защищены
                </div>
            </div>
        </div>

        <!-- Страница "О программе" -->
        <div class="about-page" id="aboutPage">
            <button class="about-back" id="aboutBack">
                <i class="fas fa-arrow-left"></i>
            </button>
            
            <div class="about-header">
                <div class="about-title">О программе</div>
                <div class="about-subtitle">CosmoSell - безопасный обмен Telegram Stars</div>
            </div>
            
            <div class="about-content">
                <div class="about-card">
                    <div class="about-card-title">
                        <i class="fas fa-shield-alt"></i>
                        Конфиденциальность и безопасность
                    </div>
                    <div class="about-card-text">
                        <strong>CosmoSell</strong> использует современные технологии шифрования для защиты ваших данных. 
                        Все транзакции обрабатываются через защищенные каналы связи. 
                        <i>Ваши личные данные никогда не передаются третьим лицам.</i>
                    </div>
                </div>
                
                <div class="about-card">
                    <div class="about-card-title">
                        <i class="fas fa-cookie-bite"></i>
                        Использование файлов cookie
                    </div>
                    <div class="about-card-text">
                        Для корректной работы приложения мы используем файлы cookie. Они помогают:
                        <br><br>
                        • <strong>Запоминать ваши настройки</strong><br>
                        • <strong>Обеспечивать безопасность сессий</strong><br>
                        • <strong>Улучшать пользовательский опыт</strong><br>
                        • <strong>Анализировать использование сервиса</strong>
                        <br><br>
                        Вы можете управлять настройками cookies в вашем браузере.
                    </div>
                </div>
                
                <div class="about-card">
                    <div class="about-card-title">
                        <i class="fas fa-user-lock"></i>
                        Защита персональных данных
                    </div>
                    <div class="about-card-text">
                        Мы соблюдаем все требования законодательства о защите персональных данных.
                        Ваша информация хранится на защищенных серверах с многоуровневой системой безопасности.
                        <i>Доступ к данным имеют только авторизованные сотрудники для обработки транзакций.</i>
                    </div>
                </div>
                
                <div class="about-card">
                    <div class="about-card-title">
                        <i class="fas fa-rocket"></i>
                        Технологии
                    </div>
                    <div class="about-card-text">
                        Приложение построено на современных веб-технологиях:
                        <br><br>
                        • <strong>HTML5, CSS3, JavaScript ES6+</strong><br>
                        • <strong>Адаптивный дизайн для всех устройств</strong><br>
                        • <strong>PWA-технологии для работы в оффлайн</strong><br>
                        • <strong>Шифрование данных end-to-end</strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- Header -->
        <div class="header" id="header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-star"></i>
                </div>
                <div class="logo-text">CosmoSell</div>
            </div>
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <!-- Индикатор скролла -->
        <div class="scroll-indicator" id="scrollIndicator"></div>

        <!-- Основной контент -->
        <div class="content-wrapper" id="contentScroll">
            <div class="content" id="content">
                <!-- Информация о получателе -->
                <div class="recipient-card" id="recipientInfo" style="display: none;">
                    <div class="recipient-label">
                        <i class="fas fa-gift"></i>
                        Покупка для:
                    </div>
                    <div class="recipient-value" id="recipientValue">@username</div>
                </div>

                <!-- Поле ввода username -->
                <div class="username-input-section" id="usernameSection">
                    <div class="input-label">
                        <i class="fas fa-user-tag"></i>
                        Username получателя
                    </div>
                    <div class="username-input-wrapper">
                        <input 
                            type="text" 
                            id="usernameInput" 
                            class="username-input" 
                            placeholder="@username или https://t.me/username"
                            maxlength="100"
                        >
                    </div>
                    <div class="username-hint">
                        <i class="fas fa-info-circle"></i>
                        Введите username с @ или ссылку на профиль
                    </div>
                </div>

                <!-- Информационные карточки -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-gem"></i>
                        </div>
                        <div class="card-title">Telegram Stars</div>
                    </div>
                    <div class="card-content">
                        Приобретайте звёзды для себя или в подарок. 
                        Без верификации, мгновенная доставка после оплаты.
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="card-title">Условия покупки</div>
                    </div>
                    <div class="card-content">
                        • Минимум: <span class="highlight">15 звёзд</span><br>
                        • Максимум: <span class="highlight">5000 звёзд</span><br>
                        • Комиссия: <span class="highlight">10 ₽ за транзакцию</span>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="card-title">Курс обмена</div>
                    </div>
                    <div class="card-content">
                        1 звезда = <span class="highlight">1.46 ₽</span><br>
                        Фиксированный курс, без скрытых комиссий
                    </div>
                </div>

                <!-- Калькулятор -->
                <div class="card calculator-card">
                    <div class="input-section">
                        <div class="input-label">
                            <i class="fas fa-star"></i>
                            Количество звёзд
                        </div>
                        <div class="stars-input-wrapper">
                            <input 
                                type="number" 
                                id="starsInput" 
                                class="stars-input" 
                                min="15" 
                                max="5000" 
                                value="100"
                                placeholder="100"
                                inputmode="numeric"
                            >
                        </div>
                        <div class="input-hint">
                            <span>От 15</span>
                            <span>До 5000</span>
                        </div>
                    </div>

                    <!-- Результаты -->
                    <div class="results-grid">
                        <div class="result-item">
                            <div class="result-label">
                                <i class="fas fa-wallet"></i>
                                К оплате
                            </div>
                            <div class="result-value" id="priceResult">156.00</div>
                            <div class="result-unit">российских рублей</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">
                                <i class="fas fa-star"></i>
                                Получите
                            </div>
                            <div class="result-value" id="starsResult">100</div>
                            <div class="result-unit">Telegram Stars</div>
                        </div>
                    </div>

                    <!-- Кнопка оплаты -->
                    <button class="btn btn-primary" id="payButton">
                        <i class="fas fa-credit-card"></i>
                        ПЕРЕЙТИ К ОПЛАТЕ
                    </button>
                </div>

                <!-- Отступ -->
                <div style="height: 50px;"></div>
            </div>
        </div>
    </div>

    <!-- Модальное окно оплаты -->
    <div class="modal-overlay" id="paymentModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-file-invoice-dollar"></i>
                    Детали платежа
                </div>
                <button class="modal-close" id="closeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="details-list">
                <div class="detail-item">
                    <span class="detail-label">Отправитель:</span>
                    <span class="detail-value">Вы</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Получатель:</span>
                    <span class="detail-value" id="modalRecipient">Вы</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Количество звёзд:</span>
                    <span class="detail-value highlight" id="modalStars">100</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Сумма к оплате:</span>
                    <span class="detail-value highlight" id="modalAmount">156.00 ₽</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">ID транзакции:</span>
                    <span class="detail-value" id="modalTransactionId">TXN00000000</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">ID вывода:</span>
                    <span class="detail-value" id="modalWithdrawalId">WDL00000000</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Время:</span>
                    <span class="detail-value" id="modalTime">Сегодня, 00:00</span>
                </div>
            </div>

            <!-- Карта Тинькофф -->
            <div class="card-payment">
                <div class="bank-header">
                    <div class="bank-info">
                        <div class="bank-logo">T</div>
                        <div class="bank-details">
                            <div class="bank-name">Тинькофф Банк</div>
                            <div class="bank-type">Дебетовая карта</div>
                        </div>
                    </div>
                    <div class="bank-icon">
                        <i class="fas fa-credit-card" style="color: var(--primary); font-size: 24px;"></i>
                    </div>
                </div>
                <div class="card-number" id="tinkoffCard">2200 7012 3315 1809</div>
                <div class="copy-hint">
                    <i class="fas fa-copy"></i>
                    Нажмите, чтобы скопировать
                </div>
            </div>

            <!-- ID вывода -->
            <div class="withdrawal-container">
                <div class="withdrawal-label">
                    <i class="fas fa-key"></i>
                    Ваш ID вывода:
                </div>
                <div class="withdrawal-value" id="withdrawalId">WDL00000000</div>
                <div class="copy-hint">
                    <i class="fas fa-copy"></i>
                    Нажмите, чтобы скопировать
                </div>
            </div>

            <!-- Важное примечание -->
            <div class="important-note">
                <div class="note-header">
                    <div class="note-icon">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <div class="note-title">Важно!</div>
                </div>
                <div class="note-content">
                    При переводе <strong>обязательно укажите в комментарии</strong> ваш ID вывода:
                    <strong id="noteWithdrawalId">WDL00000000</strong>
                    <br><br>
                    Без ID вывода в комментарии платеж <strong>не будет зачислен!</strong>
                </div>
            </div>
            
            <button class="btn btn-warning" id="confirmButton">
                <i class="fas fa-clock"></i>
                СЕЙЧАС ОПЛАЧУ
            </button>
        </div>
    </div>

    <!-- Окно загрузки -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-title" id="loadingTitle">Обработка платежа</div>
            <div class="loading-subtitle" id="loadingSubtitle">Пожалуйста, не закрывайте окно</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Окно ожидания оплаты -->
    <div class="waiting-overlay" id="waitingOverlay">
        <div class="waiting-content">
            <div class="waiting-icon">
                <i class="fas fa-hourglass-half"></i>
            </div>
            <div class="waiting-title">Ожидание оплаты</div>
            <div class="waiting-subtitle">
                Ваш заказ создан и ожидает оплаты.<br>
                После перевода средств нажмите кнопку ниже.
            </div>
            
            <div class="waiting-details">
                <div class="waiting-detail">
                    <span class="waiting-label">ID транзакции:</span>
                    <span class="waiting-value" id="waitingTransactionId">TXN00000000</span>
                </div>
                <div class="waiting-detail">
                    <span class="waiting-label">Сумма:</span>
                    <span class="waiting-value" id="waitingAmount">156.00 ₽</span>
                </div>
                <div class="waiting-detail">
                    <span class="waiting-label">Получатель:</span>
                    <span class="waiting-value" id="waitingRecipient">Вы</span>
                </div>
                <div class="waiting-detail">
                    <span class="waiting-label">Статус:</span>
                    <span class="waiting-value" style="color: var(--warning);">Ожидает оплаты</span>
                </div>
            </div>
            
            <button class="btn btn-success" id="iPaidButton">
                <i class="fas fa-check-circle"></i>
                Я ОПЛАТИЛ, ПРОДОЛЖИТЬ
            </button>
            
            <!-- Кнопки администратора (скрыты для обычных пользователей) -->
            <div class="admin-buttons" id="adminButtons" style="display: none;">
                <button class="admin-btn admin-approve" id="adminApprove">
                    <i class="fas fa-check"></i>
                    Подтвердить оплату
                </button>
                <button class="admin-btn admin-cancel" id="adminCancel">
                    <i class="fas fa-times"></i>
                    Отменить заказ
                </button>
            </div>
        </div>
    </div>

    <script>
        // Конфигурация
        const CONFIG = {
            STAR_PRICE: 1.46,
            TAX_AMOUNT: 10,
            MIN_STARS: 15,
            MAX_STARS: 5000,
            TINKOFF_CARD: "2200 7012 3315 1809",
            IS_ADMIN: false // В реальном приложении это проверяется через токен или права
        };

        // Состояние приложения
        const appState = {
            stars: 100,
            recipient: "self",
            username: "",
            transaction: null,
            isProcessing: false,
            isGiftMode: false,
            lastScrollTop: 0,
            scrollTimeout: null,
            currentPage: 'main',
            isMenuOpen: false,
            userData: {
                name: "Алексей",
                username: "@alexey_tg",
                avatarText: "А"
            },
            currentOrder: null
        };

        // Элементы DOM
        const elements = {
            // Основные
            header: document.getElementById('header'),
            contentScroll: document.getElementById('contentScroll'),
            scrollIndicator: document.getElementById('scrollIndicator'),
            
            // Меню
            menuToggle: document.getElementById('menuToggle'),
            sidebarOverlay: document.getElementById('sidebarOverlay'),
            sidebar: document.getElementById('sidebar'),
            
            // Пользователь
            userAvatar: document.getElementById('userAvatar'),
            userName: document.getElementById('userName'),
            userUsername: document.getElementById('userUsername'),
            
            // Поля ввода
            starsInput: document.getElementById('starsInput'),
            usernameInput: document.getElementById('usernameInput'),
            usernameSection: document.getElementById('usernameSection'),
            
            // Результаты
            priceResult: document.getElementById('priceResult'),
            starsResult: document.getElementById('starsResult'),
            payButton: document.getElementById('payButton'),
            
            // Получатель
            recipientInfo: document.getElementById('recipientInfo'),
            recipientValue: document.getElementById('recipientValue'),
            
            // Модальные окна
            paymentModal: document.getElementById('paymentModal'),
            closeModal: document.getElementById('closeModal'),
            confirmButton: document.getElementById('confirmButton'),
            
            // Данные модального окна
            modalRecipient: document.getElementById('modalRecipient'),
            modalStars: document.getElementById('modalStars'),
            modalAmount: document.getElementById('modalAmount'),
            modalTransactionId: document.getElementById('modalTransactionId'),
            modalWithdrawalId: document.getElementById('modalWithdrawalId'),
            modalTime: document.getElementById('modalTime'),
            
            // Платежные данные
            tinkoffCard: document.getElementById('tinkoffCard'),
            withdrawalId: document.getElementById('withdrawalId'),
            noteWithdrawalId: document.getElementById('noteWithdrawalId'),
            
            // Загрузка
            loadingOverlay: document.getElementById('loadingOverlay'),
            loadingTitle: document.getElementById('loadingTitle'),
            loadingSubtitle: document.getElementById('loadingSubtitle'),
            
            // Ожидание оплаты
            waitingOverlay: document.getElementById('waitingOverlay'),
            waitingTransactionId: document.getElementById('waitingTransactionId'),
            waitingAmount: document.getElementById('waitingAmount'),
            waitingRecipient: document.getElementById('waitingRecipient'),
            iPaidButton: document.getElementById('iPaidButton'),
            
            // Администратор
            adminButtons: document.getElementById('adminButtons'),
            adminApprove: document.getElementById('adminApprove'),
            adminCancel: document.getElementById('adminCancel'),
            
            // Частицы
            particles: document.getElementById('particles'),
            
            // О программе
            aboutPage: document.getElementById('aboutPage'),
            aboutBack: document.getElementById('aboutBack'),
            
            // Меню элементы
            menuItems: document.querySelectorAll('.menu-item')
        };

        // Утилиты
        class Utils {
            static formatPrice(price) {
                return price.toFixed(2).replace('.', ',');
            }

            static formatStars(stars) {
                return stars.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
            }

            static calculatePrice(stars) {
                const basePrice = stars * CONFIG.STAR_PRICE;
                return Math.round((basePrice + CONFIG.TAX_AMOUNT) * 100) / 100;
            }

            static validateStars(stars) {
                if (isNaN(stars)) return CONFIG.MIN_STARS;
                return Math.max(CONFIG.MIN_STARS, Math.min(CONFIG.MAX_STARS, stars));
            }

            static generateId(prefix) {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let id = prefix;
                for (let i = 0; i < 10; i++) {
                    id += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return id;
            }

            static getCurrentTime() {
                const now = new Date();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                return `Сегодня, ${hours}:${minutes}`;
            }

            static parseUsername(input) {
                if (!input || input.trim() === '') return null;
                
                let username = input.trim();
                
                // Если это ссылка, извлекаем username
                if (username.includes('t.me/') || username.includes('telegram.me/')) {
                    const match = username.match(/t\.me\/([a-zA-Z0-9_]+)/) || 
                                 username.match(/telegram\.me\/([a-zA-Z0-9_]+)/);
                    if (match && match[1]) {
                        username = '@' + match[1];
                    }
                }
                
                // Проверяем формат
                if (!username.startsWith('@')) {
                    username = '@' + username;
                }
                
                // Убираем лишние символы
                username = username.replace(/[^a-zA-Z0-9_@]/g, '');
                
                return username;
            }

            static async copyToClipboard(text) {
                try {
                    await navigator.clipboard.writeText(text);
                    return true;
                } catch (err) {
                    // Fallback
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.opacity = '0';
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    return true;
                }
            }

            static showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <div class="toast-icon">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    </div>
                    <div class="toast-message">${message}</div>
                `;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.classList.add('hiding');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, 3000);
            }

            static createParticles() {
                const particlesContainer = elements.particles;
                particlesContainer.innerHTML = '';
                
                const particleCount = 40;
                const colors = [
                    'rgba(74, 158, 255, 0.2)',
                    'rgba(0, 255, 157, 0.15)',
                    'rgba(255, 170, 0, 0.1)',
                    'rgba(255, 68, 68, 0.1)'
                ];
                
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    
                    // Размер
                    const size = Math.random() * 4 + 1;
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    
                    // Позиция
                    particle.style.left = `${Math.random() * 100}%`;
                    particle.style.top = `${Math.random() * 100}%`;
                    
                    // Цвет
                    particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    
                    // Анимация
                    const duration = Math.random() * 25 + 15;
                    const delay = Math.random() * 5;
                    const rotation = Math.random() * 360;
                    particle.style.animation = `float ${duration}s ease-in-out ${delay}s infinite`;
                    particle.style.transform = `rotate(${rotation}deg)`;
                    
                    particlesContainer.appendChild(particle);
                }
            }

            static parseUrlData() {
                try {
                    const urlParams = new URLSearchParams(window.location.search);
                    const dataParam = urlParams.get('data');
                    
                    if (dataParam) {
                        return JSON.parse(decodeURIComponent(dataParam));
                    }
                } catch (error) {
                    console.error('Ошибка парсинга URL:', error);
                }
                return null;
            }

            static showPartnerInfo() {
                Utils.showToast('Партнерская программа в разработке', 'info');
            }
        }

        // Калькулятор
        class Calculator {
            constructor() {
                this.stars = 100;
                this.update();
            }

            setStars(stars) {
                this.stars = Utils.validateStars(stars);
                this.update();
            }

            update() {
                const price = Utils.calculatePrice(this.stars);
                
                elements.starsInput.value = this.stars;
                elements.priceResult.textContent = Utils.formatPrice(price);
                elements.starsResult.textContent = Utils.formatStars(this.stars);
                
                appState.stars = this.stars;
            }

            getPrice() {
                return Utils.calculatePrice(this.stars);
            }
        }

        // Менеджер скролла
        class ScrollManager {
            constructor() {
                this.isScrolling = false;
                this.scrollDirection = 'down';
                this.lastScrollTop = 0;
                this.scrollThreshold = 150;
            }

            init() {
                elements.contentScroll.addEventListener('scroll', this.handleScroll.bind(this), { passive: true });
                this.updateScrollIndicator();
            }

            handleScroll() {
                const scrollTop = elements.contentScroll.scrollTop;
                
                // Определяем направление скролла
                if (scrollTop > this.lastScrollTop && scrollTop > 50) {
                    this.scrollDirection = 'down';
                } else if (scrollTop < this.lastScrollTop || scrollTop <= 50) {
                    this.scrollDirection = 'up';
                }
                
                // Обновляем индикатор
                this.updateScrollIndicator();
                
                // Управляем header с улучшенной логикой
                if (this.scrollDirection === 'down' && scrollTop > this.scrollThreshold) {
                    this.hideHeader();
                } else {
                    this.showHeader();
                }
                
                this.lastScrollTop = scrollTop;
                
                // Таймер для определения окончания скролла
                clearTimeout(appState.scrollTimeout);
                this.isScrolling = true;
                
                appState.scrollTimeout = setTimeout(() => {
                    this.isScrolling = false;
                    if (this.scrollDirection === 'up' || scrollTop <= this.scrollThreshold) {
                        this.showHeader();
                    }
                }, 100);
            }

            updateScrollIndicator() {
                const scrollTop = elements.contentScroll.scrollTop;
                const scrollHeight = elements.contentScroll.scrollHeight;
                const clientHeight = elements.contentScroll.clientHeight;
                
                if (scrollHeight <= clientHeight) {
                    elements.scrollIndicator.style.transform = 'scaleX(0)';
                    return;
                }
                
                const progress = scrollTop / (scrollHeight - clientHeight);
                elements.scrollIndicator.style.transform = `scaleX(${progress})`;
            }

            hideHeader() {
                elements.header.classList.add('hidden');
            }

            showHeader() {
                elements.header.classList.remove('hidden');
            }
        }

        // Менеджер меню
        class MenuManager {
            constructor() {
                this.isOpen = false;
            }

            init() {
                // Обработчики для кнопки меню
                elements.menuToggle.addEventListener('click', () => this.toggleMenu());
                elements.sidebarOverlay.addEventListener('click', () => this.closeMenu());
                
                // Обработчики для пунктов меню
                elements.menuItems.forEach(item => {
                    item.addEventListener('click', () => {
                        const page = item.getAttribute('data-page');
                        this.handleMenuItemClick(page, item);
                    });
                });
                
                // Обработчик для кнопки "Назад" в "О программе"
                elements.aboutBack.addEventListener('click', () => this.closeAboutPage());
            }

            toggleMenu() {
                this.isOpen = !this.isOpen;
                
                if (this.isOpen) {
                    this.openMenu();
                } else {
                    this.closeMenu();
                }
            }

            openMenu() {
                elements.sidebar.classList.add('active');
                elements.sidebarOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
                this.isOpen = true;
            }

            closeMenu() {
                elements.sidebar.classList.remove('active');
                elements.sidebarOverlay.classList.remove('active');
                document.body.style.overflow = '';
                this.isOpen = false;
            }

            handleMenuItemClick(page, item) {
                // Обновляем активный пункт меню
                elements.menuItems.forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                
                // Обрабатываем выбор страницы
                switch(page) {
                    case 'main':
                        this.setMainMode();
                        this.closeMenu();
                        break;
                        
                    case 'gift':
                        this.setGiftMode();
                        this.closeMenu();
                        break;
                        
                    case 'partner':
                        this.closeMenu();
                        setTimeout(() => {
                            Utils.showPartnerInfo();
                        }, 300);
                        break;
                        
                    case 'about':
                        this.closeMenu();
                        this.openAboutPage();
                        break;
                }
            }

            setMainMode() {
                appState.isGiftMode = false;
                appState.recipient = "self";
                appState.username = "";
                
                elements.usernameSection.classList.remove('active');
                elements.recipientInfo.style.display = 'none';
                elements.usernameInput.value = "";
                
                // Обновляем текст кнопки
                elements.payButton.innerHTML = `
                    <i class="fas fa-credit-card"></i>
                    ПЕРЕЙТИ К ОПЛАТЕ
                `;
                
                // Обновляем UI
                window.app.updateUI();
            }

            setGiftMode() {
                appState.isGiftMode = true;
                elements.usernameSection.classList.add('active');
                
                // Обновляем текст кнопки
                elements.payButton.innerHTML = `
                    <i class="fas fa-gift"></i>
                    ПОДАРИТЬ ЗВЁЗДЫ
                `;
                
                // Фокус на поле ввода username
                setTimeout(() => {
                    elements.usernameInput.focus();
                }, 300);
            }

            openAboutPage() {
                elements.aboutPage.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            closeAboutPage() {
                elements.aboutPage.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        // Менеджер заказов
        class OrderManager {
            constructor() {
                this.orders = JSON.parse(localStorage.getItem('cosmosell_orders') || '[]');
            }

            createOrder(transaction) {
                const order = {
                    id: transaction.id,
                    withdrawalId: transaction.withdrawalId,
                    stars: transaction.stars,
                    amount: transaction.amount,
                    recipient: transaction.recipient,
                    status: 'pending', // pending, paid, processing, completed, cancelled
                    createdAt: new Date().toISOString(),
                    paidAt: null,
                    completedAt: null
                };
                
                this.orders.push(order);
                this.saveOrders();
                
                return order;
            }

            updateOrderStatus(orderId, status) {
                const order = this.orders.find(o => o.id === orderId);
                if (order) {
                    order.status = status;
                    
                    if (status === 'paid') {
                        order.paidAt = new Date().toISOString();
                    } else if (status === 'completed') {
                        order.completedAt = new Date().toISOString();
                    }
                    
                    this.saveOrders();
                    return true;
                }
                return false;
            }

            getOrder(orderId) {
                return this.orders.find(o => o.id === orderId);
            }

            saveOrders() {
                localStorage.setItem('cosmosell_orders', JSON.stringify(this.orders));
            }

            // Имитация уведомления в бот (в реальном приложении здесь был бы API вызов)
            notifyAdmin(order, action) {
                console.log(`Уведомление администратору: ${action} заказа ${order.id}`);
                
                // В реальном приложении здесь был бы WebSocket или API запрос
                const notification = {
                    type: 'order_notification',
                    orderId: order.id,
                    action: action,
                    recipient: order.recipient,
                    amount: order.amount,
                    stars: order.stars,
                    timestamp: new Date().toISOString()
                };
                
                // Сохраняем уведомление для демонстрации
                localStorage.setItem('last_admin_notification', JSON.stringify(notification));
                
                return true;
            }

            // Имитация уведомления пользователя
            notifyUser(order, message) {
                console.log(`Уведомление пользователю: ${message}`);
                
                // В реальном приложении здесь был бы WebSocket или API запрос
                const notification = {
                    type: 'user_notification',
                    orderId: order.id,
                    message: message,
                    timestamp: new Date().toISOString()
                };
                
                return true;
            }
        }

        // Основное приложение
        class App {
            constructor() {
                this.calculator = new Calculator();
                this.scrollManager = new ScrollManager();
                this.menuManager = new MenuManager();
                this.orderManager = new OrderManager();
                this.init();
            }

            init() {
                // Создаем частицы
                Utils.createParticles();
                
                // Инициализируем менеджер скролла
                this.scrollManager.init();
                
                // Инициализируем менеджер меню
                this.menuManager.init();
                
                // Настраиваем обработчики событий
                this.setupEventListeners();
                
                // Загружаем данные из URL
                this.loadFromUrl();
                
                // Проверяем права администратора (для демонстрации можно изменить в CONFIG)
                this.checkAdminStatus();
                
                // Обновляем интерфейс
                this.updateUI();
                this.updateUserInfo();
                
                // Фиксируем высоту для мобильных
                this.fixViewportHeight();
            }

            setupEventListeners() {
                // Ввод количества звезд
                elements.starsInput.addEventListener('input', () => {
                    const stars = parseInt(elements.starsInput.value) || CONFIG.MIN_STARS;
                    this.calculator.setStars(stars);
                });

                elements.starsInput.addEventListener('blur', () => {
                    const stars = parseInt(elements.starsInput.value) || CONFIG.MIN_STARS;
                    this.calculator.setStars(stars);
                });

                // Ввод username
                elements.usernameInput.addEventListener('input', () => {
                    this.validateUsername();
                });

                elements.usernameInput.addEventListener('blur', () => {
                    this.validateUsername();
                });

                // Кнопка оплаты
                elements.payButton.addEventListener('click', () => this.showPaymentModal());

                // Закрытие модального окна оплаты
                elements.closeModal.addEventListener('click', () => this.hidePaymentModal());
                elements.paymentModal.addEventListener('click', (e) => {
                    if (e.target === elements.paymentModal) this.hidePaymentModal();
                });

                // Подтверждение оплаты (Сейчас оплачу)
                elements.confirmButton.addEventListener('click', () => this.confirmPayment());

                // Кнопка "Я оплатил"
                elements.iPaidButton.addEventListener('click', () => this.markAsPaid());

                // Кнопки администратора
                elements.adminApprove.addEventListener('click', () => this.adminApproveOrder());
                elements.adminCancel.addEventListener('click', () => this.adminCancelOrder());

                // Копирование данных
                elements.tinkoffCard.addEventListener('click', () => this.copyCardNumber());
                elements.withdrawalId.addEventListener('click', () => this.copyWithdrawalId());

                // Предотвращение масштабирования
                document.addEventListener('touchstart', (e) => {
                    if (e.touches.length > 1) e.preventDefault();
                }, { passive: false });

                document.addEventListener('gesturestart', (e) => e.preventDefault());
            }

            loadFromUrl() {
                const data = Utils.parseUrlData();
                
                if (data) {
                    // Устанавливаем количество звезд
                    if (data.stars) {
                        this.calculator.setStars(data.stars);
                    }
                    
                    // Устанавливаем получателя
                    if (data.recipient && data.recipient !== "self") {
                        appState.recipient = data.recipient;
                        appState.isGiftMode = true;
                        elements.usernameSection.classList.add('active');
                        elements.usernameInput.value = data.recipient;
                    }
                    
                    // Создаем или используем транзакцию
                    appState.transaction = {
                        id: data.transaction_id || Utils.generateId('TXN'),
                        withdrawalId: Utils.generateId('WDL'),
                        stars: data.stars || appState.stars,
                        amount: data.amount || this.calculator.getPrice(),
                        recipient: data.recipient || "self",
                        timestamp: data.timestamp || new Date().toISOString()
                    };
                }
            }

            checkAdminStatus() {
                // В реальном приложении здесь была бы проверка токена или прав
                if (CONFIG.IS_ADMIN) {
                    elements.adminButtons.style.display = 'flex';
                }
            }

            validateUsername() {
                const input = elements.usernameInput.value.trim();
                
                if (!appState.isGiftMode || !input) {
                    appState.username = "";
                    elements.recipientInfo.style.display = 'none';
                    return;
                }
                
                const username = Utils.parseUsername(input);
                
                if (username) {
                    appState.username = username;
                    appState.recipient = username;
                    this.updateRecipientInfo();
                } else {
                    appState.username = "";
                    appState.recipient = "self";
                    elements.recipientInfo.style.display = 'none';
                }
            }

            updateUI() {
                // Показываем информацию о получателе если нужно
                if (appState.recipient && appState.recipient !== "self") {
                    this.updateRecipientInfo();
                } else {
                    elements.recipientInfo.style.display = 'none';
                }
            }

            updateRecipientInfo() {
                elements.recipientInfo.style.display = 'block';
                elements.recipientValue.textContent = appState.recipient;
            }

            updateUserInfo() {
                elements.userName.textContent = appState.userData.name;
                elements.userUsername.textContent = appState.userData.username;
                elements.userAvatar.innerHTML = appState.userData.avatarText;
            }

            showPaymentModal() {
                if (appState.isProcessing) return;
                
                // Проверяем username в режиме подарка
                if (appState.isGiftMode) {
                    this.validateUsername();
                    
                    if (!appState.username || appState.recipient === "self") {
                        Utils.showToast('Введите username получателя', 'warning');
                        elements.usernameInput.focus();
                        return;
                    }
                    
                    // Проверяем валидность username
                    const username = Utils.parseUsername(appState.username);
                    if (!username) {
                        Utils.showToast('Некорректный username. Введите @username или ссылку', 'error');
                        elements.usernameInput.focus();
                        return;
                    }
                }
                
                // Создаем транзакцию если её нет
                if (!appState.transaction) {
                    appState.transaction = {
                        id: Utils.generateId('TXN'),
                        withdrawalId: Utils.generateId('WDL'),
                        stars: appState.stars,
                        amount: this.calculator.getPrice(),
                        recipient: appState.recipient,
                        timestamp: new Date().toISOString()
                    };
                }
                
                // Заполняем данные в модальном окне
                const recipientText = appState.recipient === "self" ? "Вы" : appState.recipient;
                const starsText = Utils.formatStars(appState.transaction.stars);
                const amountText = Utils.formatPrice(appState.transaction.amount);
                
                elements.modalRecipient.textContent = recipientText;
                elements.modalStars.textContent = starsText;
                elements.modalAmount.textContent = `${amountText} ₽`;
                elements.modalTransactionId.textContent = appState.transaction.id;
                elements.modalWithdrawalId.textContent = appState.transaction.withdrawalId;
                elements.modalTime.textContent = Utils.getCurrentTime();
                
                elements.withdrawalId.textContent = appState.transaction.withdrawalId;
                elements.noteWithdrawalId.textContent = appState.transaction.withdrawalId;
                
                // Показываем модальное окно
                elements.paymentModal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            hidePaymentModal() {
                elements.paymentModal.classList.remove('active');
                document.body.style.overflow = '';
            }

            async copyCardNumber() {
                const success = await Utils.copyToClipboard(CONFIG.TINKOFF_CARD.replace(/\s/g, ''));
                if (success) {
                    Utils.showToast('Номер карты скопирован в буфер обмена', 'success');
                }
            }

            async copyWithdrawalId() {
                if (!appState.transaction) return;
                
                const success = await Utils.copyToClipboard(appState.transaction.withdrawalId);
                if (success) {
                    Utils.showToast('ID вывода скопирован в буфер обмена', 'success');
                }
            }

            confirmPayment() {
                if (appState.isProcessing) return;
                
                appState.isProcessing = true;
                
                // Анимация нажатия кнопки
                elements.confirmButton.style.transform = 'scale(0.96)';
                setTimeout(() => {
                    elements.confirmButton.style.transform = '';
                }, 200);
                
                // Скрываем модальное окно оплаты
                this.hidePaymentModal();
                
                // Создаем заказ
                const order = this.orderManager.createOrder(appState.transaction);
                appState.currentOrder = order;
                
                // Показываем окно ожидания оплаты
                this.showWaitingOverlay(order);
                
                // Уведомляем администратора о новом заказе
                this.orderManager.notifyAdmin(order, 'new_order');
                
                appState.isProcessing = false;
            }

            showWaitingOverlay(order) {
                elements.waitingTransactionId.textContent = order.id;
                elements.waitingAmount.textContent = Utils.formatPrice(order.amount) + ' ₽';
                elements.waitingRecipient.textContent = order.recipient === "self" ? "Вы" : order.recipient;
                
                elements.waitingOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            hideWaitingOverlay() {
                elements.waitingOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }

            markAsPaid() {
                if (!appState.currentOrder || appState.isProcessing) return;
                
                appState.isProcessing = true;
                
                // Анимация нажатия кнопки
                elements.iPaidButton.style.transform = 'scale(0.96)';
                setTimeout(() => {
                    elements.iPaidButton.style.transform = '';
                }, 200);
                
                // Обновляем статус заказа
                this.orderManager.updateOrderStatus(appState.currentOrder.id, 'paid');
                
                // Уведомляем администратора
                this.orderManager.notifyAdmin(appState.currentOrder, 'user_paid');
                
                // Показываем уведомление
                Utils.showToast('Статус обновлен. Ожидайте подтверждения администратора.', 'info');
                
                // Скрываем окно ожидания
                this.hideWaitingOverlay();
                
                // Возвращаемся наверх
                setTimeout(() => {
                    this.scrollManager.showHeader();
                    elements.contentScroll.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                }, 500);
                
                appState.isProcessing = false;
            }

            adminApproveOrder() {
                if (!appState.currentOrder || appState.isProcessing) return;
                
                appState.isProcessing = true;
                
                // Обновляем статус заказа
                this.orderManager.updateOrderStatus(appState.currentOrder.id, 'completed');
                
                // Уведомляем пользователя
                this.orderManager.notifyUser(appState.currentOrder, 'Ваш заказ подтвержден! Звезды будут доставлены в ближайшее время.');
                
                // Показываем уведомление
                Utils.showToast('Заказ подтвержден. Пользователь уведомлен.', 'success');
                
                // Скрываем окно ожидания
                this.hideWaitingOverlay();
                
                appState.isProcessing = false;
            }

            adminCancelOrder() {
                if (!appState.currentOrder || appState.isProcessing) return;
                
                appState.isProcessing = true;
                
                // Обновляем статус заказа
                this.orderManager.updateOrderStatus(appState.currentOrder.id, 'cancelled');
                
                // Уведомляем пользователя
                this.orderManager.notifyUser(appState.currentOrder, 'Ваш заказ отменен администратором. Свяжитесь с поддержкой для уточнения деталей.');
                
                // Показываем уведомление
                Utils.showToast('Заказ отменен. Пользователь уведомлен.', 'error');
                
                // Скрываем окно ожидания
                this.hideWaitingOverlay();
                
                appState.isProcessing = false;
            }

            fixViewportHeight() {
                const updateHeight = () => {
                    const vh = window.innerHeight * 0.01;
                    document.documentElement.style.setProperty('--vh', `${vh}px`);
                    
                    // Обновляем высоту контента
                    const headerHeight = elements.header.offsetHeight;
                    elements.contentScroll.style.height = `calc(100vh - ${headerHeight}px - var(--safe-bottom))`;
                };
                
                updateHeight();
                window.addEventListener('resize', updateHeight);
                window.addEventListener('orientationchange', () => {
                    setTimeout(updateHeight, 100);
                });
            }
        }

        // Запуск приложения
        document.addEventListener('DOMContentLoaded', () => {
            window.app = new App();
            
            // Дополнительные настройки для iOS
            if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                document.documentElement.style.cursor = 'pointer';
            }
            
            // Для тестирования админ-функций
            // Чтобы включить админ-панель, измените CONFIG.IS_ADMIN на true
        });
    </script>
</body>
</html>